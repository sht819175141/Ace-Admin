(function(a,b){a.omWidget("om.omDraggable",a.om.omMouse,{widgetEventPrefix:"drag",options:{axis:false,containment:false,cursor:"auto",_scope:"default",handle:false,helper:"original",revert:false,scroll:true},_create:function(){if(this.options.helper=="original"&&!(/^(?:r|a|f)/).test(this.element.css("position"))){this.element[0].style.position="relative"}this.element.addClass("om-draggable");(this.options.disabled&&this.element.addClass("om-draggable-disabled"));this._mouseInit()},destroy:function(){if(!this.element.data("omDraggable")){return}this.element.removeData("omDraggable").unbind(".draggable").removeClass("om-draggable om-draggable-dragging om-draggable-disabled");this._mouseDestroy();return this},_mouseCapture:function(c){var d=this.options;if(this.helper||d.disabled||a(c.target).is(".om-resizable-handle")){return false}this.handle=this._getHandle(c);if(!this.handle){return false}return true},_mouseStart:function(c){var d=this.options;this.helper=this._createHelper(c);this._cacheHelperProportions();if(a.om.ddmanager){a.om.ddmanager.current=this}this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:c.pageX-this.offset.left,top:c.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(c);this.originalPageX=c.pageX;this.originalPageY=c.pageY;if(d.containment){this._setContainment()}if(this._trigger("onStart",c)===false){this._clear();return false}this._cacheHelperProportions();if(a.om.ddmanager&&!d.dropBehaviour){a.om.ddmanager.prepareOffsets(this,c)}this.helper.addClass("om-draggable-dragging");this._mouseDrag(c,true);if(a.om.ddmanager){a.om.ddmanager.dragStart(this,c)}return true},_mouseDrag:function(c,e){this.position=this._generatePosition(c);this.positionAbs=this._convertPositionTo("absolute");if(!e){var d=this._uiHash();if(this._trigger("onDrag",c,d)===false){this._mouseUp({});return false}this.position=d.position}if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px"}if(a.om.ddmanager){a.om.ddmanager.drag(this,c)}return false},_mouseStop:function(d){var e=false;if(a.om.ddmanager&&!this.options.dropBehaviour){e=a.om.ddmanager.drop(this,d)}if(this.dropped){e=this.dropped;this.dropped=false}if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original"){return false}if((this.options.revert=="invalid"&&!e)||(this.options.revert=="valid"&&e)||this.options.revert===true||(a.isFunction(this.options.revert)&&this.options.revert.call(this.element,e))){var c=this;a(this.helper).animate(this.originalPosition,500,function(){if(c._trigger("onStop",d)!==false){c._clear()}})}else{if(this._trigger("onStop",d)!==false){this._clear()}}return false},_mouseUp:function(c){if(a.om.ddmanager){a.om.ddmanager.dragStop(this,c)}return a.om.omMouse.prototype._mouseUp.call(this,c)},cancel:function(){if(this.helper.is(".om-draggable-dragging")){this._mouseUp({})}else{this._clear()}return this},_getHandle:function(c){var d=!this.options.handle||!a(this.options.handle,this.element).length?true:false;a(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==c.target){d=true}});return d},_createHelper:function(d){var e=this.options;var c=a.isFunction(e.helper)?a(e.helper.apply(this.element[0],[d])):(e.helper=="clone"?this.element.clone().removeAttr("id"):this.element);if(!c.parents("body").length){c.appendTo(this.element[0].parentNode)}if(c[0]!=this.element[0]&&!(/(fixed|absolute)/).test(c.css("position"))){c.css("position","absolute")}return c},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var c=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.contains(this.scrollParent[0],this.offsetParent[0])){c.left+=this.scrollParent.scrollLeft();c.top+=this.scrollParent.scrollTop()}if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)){c={top:0,left:0}}return{top:c.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:c.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var c=this.element.position();return{top:c.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:c.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var g=this.options;if(g.containment=="parent"){g.containment=this.helper[0].parentNode}if(g.containment=="document"||g.containment=="window"){this.containment=[g.containment=="document"?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,g.containment=="document"?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(g.containment=="document"?0:a(window).scrollLeft())+a(g.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(g.containment=="document"?0:a(window).scrollTop())+(a(g.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!(/^(document|window|parent)$/).test(g.containment)&&g.containment.constructor!=Array){var h=a(g.containment);var e=h[0];if(!e){return}var f=h.offset();var d=(a(e).css("overflow")!="hidden");this.containment=[(parseInt(a(e).css("borderLeftWidth"),10)||0)+(parseInt(a(e).css("paddingLeft"),10)||0),(parseInt(a(e).css("borderTopWidth"),10)||0)+(parseInt(a(e).css("paddingTop"),10)||0),(d?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(a(e).css("borderLeftWidth"),10)||0)-(parseInt(a(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(d?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(a(e).css("borderTopWidth"),10)||0)-(parseInt(a(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=h}else{if(g.containment.constructor==Array){this.containment=g.containment}}},_convertPositionTo:function(g,i){if(!i){i=this.position}var e=g=="absolute"?1:-1;var f=this.options,c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=(/(html|body)/i).test(c[0].tagName);return{top:(i.top+this.offset.relative.top*e+this.offset.parent.top*e-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(h?0:c.scrollTop()))*e)),left:(i.left+this.offset.relative.left*e+this.offset.parent.left*e-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:c.scrollLeft())*e))}},_generatePosition:function(f){var h=this.options,c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,j=(/(html|body)/i).test(c[0].tagName);var e=f.pageX;var d=f.pageY;if(this.originalPosition){var i;if(this.containment){if(this.relative_container){var g=this.relative_container.offset();i=[this.containment[0]+g.left,this.containment[1]+g.top,this.containment[2]+g.left,this.containment[3]+g.top]}else{i=this.containment}if(f.pageX-this.offset.click.left<i[0]){e=i[0]+this.offset.click.left}if(f.pageY-this.offset.click.top<i[1]){d=i[1]+this.offset.click.top}if(f.pageX-this.offset.click.left>i[2]){e=i[2]+this.offset.click.left}if(f.pageY-this.offset.click.top>i[3]){d=i[3]+this.offset.click.top}}}return{top:(d-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(j?0:c.scrollTop())))),left:(e-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():j?0:c.scrollLeft())))}},_clear:function(){this.helper.removeClass("om-draggable-dragging");if(this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval){this.helper.remove()}this.helper=null;this.cancelHelperRemoval=false},_trigger:function(c,d,e){e=e||this._uiHash();a.om.plugin.call(this,c,[d,e]);if(c=="onDrag"){this.positionAbs=this._convertPositionTo("absolute")}return a.OMWidget.prototype._trigger.call(this,c,d,e)},plugins:{},_uiHash:function(c){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});a.om.plugin.add("omDraggable","cursor",{onStart:function(e,d){var c=a("body"),f=a(this).data("omDraggable").options;if(c.css("cursor")){f._cursor=c.css("cursor")}c.css("cursor",f.cursor)},onStop:function(e,d){var c=a(this).data("omDraggable");if(c){var f=c.options;if(f._cursor){a("body").css("cursor",f._cursor)}}}});a.om.plugin.add("omDraggable","scroll",{onStart:function(e,d){var c=a(this).data("omDraggable");if(c.scrollParent[0]!=document&&c.scrollParent[0].tagName!="HTML"){c.overflowOffset=c.scrollParent.offset()}},onDrag:function(h,g){var e=a(this).data("omDraggable"),j=e.options,c=false,d=20,f=20;if(e.scrollParent[0]!=document&&e.scrollParent[0].tagName!="HTML"){if(!j.axis||j.axis!="x"){if((e.overflowOffset.top+e.scrollParent[0].offsetHeight)-g.pageY<d){e.scrollParent[0].scrollTop=c=e.scrollParent[0].scrollTop+f}else{if(g.pageY-e.overflowOffset.top<d){e.scrollParent[0].scrollTop=c=e.scrollParent[0].scrollTop-f}}}if(!j.axis||j.axis!="y"){if((e.overflowOffset.left+e.scrollParent[0].offsetWidth)-g.pageX<d){e.scrollParent[0].scrollLeft=c=e.scrollParent[0].scrollLeft+f}else{if(g.pageX-e.overflowOffset.left<d){e.scrollParent[0].scrollLeft=c=e.scrollParent[0].scrollLeft-f}}}}else{if(!j.axis||j.axis!="x"){if(g.pageY-a(document).scrollTop()<d){c=a(document).scrollTop(a(document).scrollTop()-f)}else{if(a(window).height()-(g.pageY-a(document).scrollTop())<d){c=a(document).scrollTop(a(document).scrollTop()+f)}}}if(!j.axis||j.axis!="y"){if(g.pageX-a(document).scrollLeft()<d){c=a(document).scrollLeft(a(document).scrollLeft()-f)}else{if(a(window).width()-(g.pageX-a(document).scrollLeft())<d){c=a(document).scrollLeft(a(document).scrollLeft()+f)}}}}if(c!==false&&a.om.ddmanager&&!j.dropBehaviour){a.om.ddmanager.prepareOffsets(e,g)}}})})(jQuery);