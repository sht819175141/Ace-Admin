(function(d){var b=["collapse","min","max","close"],a=["om-panel-tool-collapse","om-panel-tool-expand","om-panel-tool-min","om-panel-tool-max","om-panel-tool-close"],c={anim:true,speed:"fast"};d.omWidget("om.omPanel",{options:{title:"",width:"auto",height:"auto",header:true,collapsible:false,closable:false,closed:false,collapsed:false,tools:[],loadingMessage:"default",_closeMode:"hidden",_helpMsg:false},_create:function(){this.element.addClass("om-panel-body om-widget-content").wrap("<div class='om-widget om-panel'></div>")},_init:function(){var g=this.options,h=this.element,i=h.parent(),f;this._renderHeader();f=h.prev();if(g.header===false){h.addClass("om-panel-noheader")}this._bindEvent();this._resize(i);var e=g.header!==false?f.outerHeight():0;if(g.collapsed!==false){"auto"!==g.height&&i.height(e);h.hide();if(g.header!==false){f.find(">.om-panel-tool >.om-panel-tool-collapse").removeClass("om-panel-tool-collapse").addClass("om-panel-tool-expand")}}else{h.show();"auto"!==g.height&&i.height(e+h.outerHeight());if(g.header!==false){f.find(">.om-panel-tool >.om-panel-tool-expand").removeClass("om-panel-tool-expand").addClass("om-panel-tool-collapse")}}g.closed!==false?this._hide(i):this._show(i);this.reload()},_hide:function(e){if("hidden"===this.options._closeMode){e.hide()}else{if("visibility"===this.options._closeMode){e.addClass("om-helper-hidden-accessible")}}},_show:function(e){if("hidden"===this.options._closeMode){e.show()}else{if("visibility"===this.options._closeMode){e.removeClass("om-helper-hidden-accessible")}}},_bindEvent:function(){var e=this,g=this.element,f=this.options,h=g.prev();if(f.collapsible!==false){h.click(function(i){if(d(i.target).is(".om-panel-icon,.om-panel-title,.om-panel-header")){f.collapsed!==false?e.expand():e.collapse()}}).find(".om-panel-tool-collapse , .om-panel-tool-expand").click(function(){f.collapsed!==false?e.expand():e.collapse()})}if(f.closable!==false){h.find(".om-panel-tool-close").click(function(i){e.close()})}},_renderHeader:function(){this.header&&this.header.remove();if(this.options.header===false){return}var h=this,n=this.options,g=n.tools,e=this.header=d("<div class='om-panel-header'></div>").insertBefore(this.element);if(n._helpMsg){e.parent().addClass("helpMsg")}if(n.iconCls){d("<div class='om-icon om-panel-icon'></div>").addClass(n.iconCls).appendTo(e)}d("<div class='om-panel-title'></div>").html(n.title).appendTo(e);$tool=d("<div class='om-panel-tool'></div>");if(n.collapsible!==false){d("<div class='om-icon om-panel-tool-collapse'></div>").appendTo($tool)}if(d.isArray(g)){for(var f=0,k=g.length;f<k;f++){var j=g[f],m;if(m=this._getInnerToolCls(j.id)){d("<div class='om-icon'></div>").addClass(m).click(function(i){j.handler.call(this,h,i)}).appendTo($tool)}else{if(typeof j.iconCls==="string"){d("<div class='om-icon'></div>").addClass(j.iconCls).click(function(i){j.handler.call(this,h,i)}).appendTo($tool)}else{if(d.isArray(j.iconCls)){(function(i){d("<div class='om-icon'></div>").addClass(i.iconCls[0]).click(function(o){i.handler.call(this,h,o)}).hover(function(){if(i.iconCls[1]){d(this).toggleClass(i.iconCls[1])}}).appendTo($tool)})(j)}}}}}else{try{d(g).appendTo($tool)}catch(l){throw"bad format of jquery selector."}}if(n.closable!==false){d("<div class='om-icon om-panel-tool-close'></div>").appendTo($tool)}$tool.find(">div.om-icon").hover(function(){var i=this;d.each(a,function(){if(d(i).hasClass(this)){d(i).toggleClass(this+"-hover")}})});$tool.appendTo(e)},_resize:function(i){var h=this.element,e=h.prev(),i=h.parent(),f=this.options;if(f.width=="fit"){f.width="100%";i.width("100%");e.css("width","");h.css("width","")}else{if(f.width!=="auto"){i.width(f.width);e.outerWidth(i.width());h.outerWidth(i.width())}else{var g=h.attr("style");if(g&&g.indexOf("width")!==-1){i.width(h.outerWidth());e.outerWidth(h.outerWidth())}else{i.css("width","");e.css("width","");h.css("width","")}}}if(f.height=="fit"){f.height="100%";i.height("100%");h.outerHeight(i.height()-(this.options.header!==false?e.outerHeight():0))}else{if(f.height!=="auto"){i.height(f.height);h.outerHeight(i.height()-(this.options.header!==false?e.outerHeight():0))}else{var g=h.attr("style");if(g&&g.indexOf("height")!==-1){i.height(e.outerHeight()+h.outerHeight())}else{i.css("height","");h.css("height","")}}}},_getInnerToolCls:function(e){return d.inArray(e,b)!=-1?"om-panel-tool-"+e:null},_showLoadingMessage:function(){var f=this.options,g=this.element,h=g.next(".om-panel-loadingMessage"),e={width:g.innerWidth(),height:g.innerHeight(),left:g.position().left+parseInt(g.css("border-left-width")),top:g.position().top};if(h.length===0){if("default"===f.loadingMessage){d("<div class='om-panel-loadingMessage'><div class='valignMiddle'><div class='loadingImg'>数据加载中</div></div></div>").css(e).appendTo(g.parent())}else{d("<div class='om-panel-loadingMessage'></div>").appendTo(g.parent()).html(f.loadingMessage).css(e)}}else{h.css(e).show()}},_hideLoadingMessage:function(){this.element.parent().find(".om-panel-loadingMessage").hide()},setTitle:function(e){this.element.prev().find(">.om-panel-title").html(e)},setIconClass:function(g){var f=this.element.prev();var e=f.find(">.om-panel-icon");if(g==null&&e.length!==0){e.remove()}else{if(e.length==0){e=d("<div class='om-icon om-panel-icon'></div>").insertBefore(f.find(">.om-panel-title"))}if(this.options.iconCls){e.removeClass(this.options.iconCls)}e.addClass(g);this.options.iconCls=g}},open:function(){var f=this.element,e=this.options;if(e.closed){if(e.onBeforeOpen&&this._trigger("onBeforeOpen")===false){return}this._show(f.parent());e.closed=false;e.onOpen&&this._trigger("onOpen")}},close:function(){var f=this.element,e=this.options;if(!e.closed){if(e.onBeforeClose&&this._trigger("onBeforeClose")===false){return}this._hide(f.parent());e.closed=true;e.onClose&&this._trigger("onClose")}},reload:function(g){var f=this.options,h=this.element,e=this;if(h.data("loading")){return}else{h.data("loading",true)}g=g||f.url;if(!g){h.data("loading",false);return}f.url=g;this._showLoadingMessage();d.ajax(g,{cache:false,success:function(j,k,i){h.html(f.preProcess?f.preProcess.call(h[0],j,k):j);h.data("loading",false);e._hideLoadingMessage();f.onSuccess&&e._trigger("onSuccess",null,j,k,i)},error:function(i,k,j){h.data("loading",false);e._hideLoadingMessage();f.onError&&e._trigger("onError",null,i,k,j)}})},resize:function(f){var g=this.options,h,e;if(d.isPlainObject(f)){h=f.width||null;e=f.height||null}else{h=arguments[0];e=arguments[1]}g.width=h||g.width;g.height=e||g.height;this._resize(this.element.parent())},collapse:function(){var l=this,i=this.element,e=i.prev(),h=i.parent(),k=i.next(".om-panel-loadingMessage"),m=this.options,g=c.anim,f=c.speed;if(arguments[0]!=undefined){g=arguments[0]}f=arguments[1]||f;if(m.onBeforeCollapse&&l._trigger("onBeforeCollapse")===false){return}h.stop(true,true);if(e.length!==0){var j=e.find("> .om-panel-tool > div.om-panel-tool-collapse");if(j.length!==0){j.removeClass("om-panel-tool-collapse").addClass("om-panel-tool-expand");if(j.hasClass("om-panel-tool-collapse-hover")){j.toggleClass("om-panel-tool-collapse-hover om-panel-tool-expand-hover")}}}h.animate({height:"-="+i.outerHeight()},g?(f||"normal"):0,function(){i.hide();k.hide();"auto"===m.height&&h.css("height","");m.onCollapse&&l._trigger("onCollapse")});m.collapsed=true},expand:function(){var l=this,i=this.element,e=i.prev(),h=i.parent(),k=i.next(".om-panel-loadingMessage"),m=this.options,g=c.anim,f=c.speed;if(arguments[0]!=undefined){g=arguments[0]}f=arguments[1]||f;if(m.onBeforeExpand&&l._trigger("onBeforeExpand")===false){return}h.stop(true,true);if(e.length!==0){var j=e.find("> .om-panel-tool > div.om-panel-tool-expand");if(j.length!==0){j.removeClass("om-panel-tool-expand").addClass("om-panel-tool-collapse");if(j.hasClass("om-panel-tool-expand-hover")){j.toggleClass("om-panel-tool-expand-hover om-panel-tool-collapse-hover")}}}"auto"===m.height&&h.height(e.outerHeight());i.show();if(i.data("loading")){k.show()}h.animate({height:"+="+i.outerHeight()},g?(f||"normal"):0,function(){"auto"===m.height&&h.css("height","");m.onExpand&&l._trigger("onExpand")});m.collapsed=false},destroy:function(){var e=this.element;e.parent().after(e).remove()}})})(jQuery);