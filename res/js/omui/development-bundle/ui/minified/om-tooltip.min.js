(function(a){a.omWidget("om.omTooltip",{options:{width:"auto",minWidth:null,maxWidth:null,height:"auto",maxHeight:null,minHeight:null,delay:300,anchor:false,trackMouse:false,showOn:"mouseover",lazyLoad:false,url:null,offset:[5,5],anchorOffset:0,region:null,html:null,contentEL:null},_create:function(){this.tipContent=a('<div class="tip-body"></div>');this.tipAnchor=a('<div class="tip-anchor"></div>');this.regionMap={right:"left",top:"bottom",left:"right",bottom:"top"};this.tip=a('<div class="tip"></div>').append(this.tipContent)},_init:function(){var c=this,d=c.options;this.tipContent.empty();this.tip.find("div.tip-anchor").remove();if(d.anchor){c.tip.append(c.tipAnchor)}c.adjustWidth=6;c.adjustHeight=6;if(d.width!="auto"){this.tip.css("width",d.width-c.adjustWidth)}else{this.tip.css("width","auto")}if(d.height!="auto"){this.tip.css("height",d.height-c.adjustHeight)}else{this.tip.css("height","auto")}if(d.minWidth){this.tip.css("minWidth",d.minWidth-c.adjustWidth)}if(d.maxWidth){this.tip.css("maxWidth",d.maxWidth-c.adjustWidth)}if(d.maxHeight){this.tip.css("maxHeight",d.maxHeight-c.adjustHeight)}if(d.minHeight){this.tip.css("minHeight",d.minHeight-c.adjustHeight)}if(d.url&&!d.lazyLoad){c._ajaxLoad(d.url)}else{if(d.html){this.tip.find(".tip-body").append(d.html)}else{var b=a(d.contentEL).clone();a(d.contentEL).remove();this.tip.find(".tip-body").append(b.show())}}this._bindEvent()},_ajaxLoad:function(c){var b=this;a.ajax({url:c,method:"POST",dataType:"html",success:function(d,e){b.tip.find(".tip-body").append(d)},error:function(d,f,e){b.tip.find(".tip-body").append(a.om.lang.omTooltip.FailedToLoad)}})},_bindEvent:function(){var b=this,c=b.options,d=b.element;if(c.showOn=="mouseover"){d.bind("mouseover.tooltip",function(f){if(b.showTime){clearTimeout(b.showTime)}b.showTime=setTimeout(function(){b.show(f)},c.delay)})}else{if(c.showOn=="click"){b.showTime=d.bind("click.tooltip",function(f){setTimeout(function(){b.show(f)},c.delay)})}}if(c.trackMouse){d.bind("mousemove.tooltip",function(f){b._adjustPosition(f)})}d.bind("mouseleave.tooltip",function(){if(b.showTime){clearTimeout(b.showTime)}b.hideTime=setTimeout(function(){b.hide()},c.delay)});b.tip.bind("mouseover.tooltip",function(){if(b.hideTime){clearTimeout(b.hideTime)}}).bind("mouseleave.tooltip",function(){setTimeout(function(){b.hide()},c.delay)})},show:function(d){var b=this,c=b.options;if(a(document.body).find(b.tip).length<=0){if(c.url&&c.lazyLoad){b._ajaxLoad(c.url)}b.tip.appendTo(document.body).fadeIn();b._adjustPosition(d)}else{b._adjustPosition(d);b.tip.fadeIn()}},_adjustPosition:function(g){var b=this,c=b.options,d=b.element,i,h,f=a(d).offset();if(g&&!c.region){i=g.pageY+c.offset[0];h=g.pageX+c.offset[1];b.tip.find(".tip-anchor").css({top:c.anchorOffset+3,left:"-9px"}).addClass("tip-anchor-left")}else{var e=parseInt(a(d).css("borderBottomWidth").replace("px",""));i=f.top+a(d).height()+(isNaN(e)?0:e)+c.offset[0];h=f.left+c.offset[1];if(c.region=="right"){h=f.left+c.offset[1]+a(d).width()+b.adjustWidth;i=i-b.element.height()+b.adjustHeight+c.offset[0];b.tip.find(".tip-anchor").css({top:c.anchorOffset+3,left:"-9px"})}else{if(c.region=="left"){h=f.left-b.tip.width()-b.adjustWidth-c.offset[1]-2;i=i-b.element.height()-b.adjustHeight-c.offset[0];b.tip.find(".tip-anchor").css({top:c.anchorOffset+3,left:b.tip.outerWidth()-2})}else{if(c.region=="top"){i=i-(b.element.height()+b.tip.height()+b.adjustHeight+2)-c.offset[0];h=h+c.offset[1];b.tip.find(".tip-anchor").css({top:b.tip.outerHeight()-3,left:c.anchorOffset+3})}else{if(c.region=="bottom"){i=i+c.offset[0];h=h+c.offset[1];b.tip.find(".tip-anchor").css({top:-9,left:c.anchorOffset+3})}}}}b.tip.find(".tip-anchor").addClass("tip-anchor-"+b.regionMap[c.region])}if((h+b.tip.width())>document.documentElement.clientWidth){h=h-b.tip.width()-20}if((i+b.tip.height())>document.documentElement.clientHeight){i=i-(b.element.height()+b.tip.height())-20}b.tip.css({top:i-a(document).scrollTop(),left:h-a(document).scrollLeft()})},hide:function(){this.tip.hide()},destroy:function(){clearTimeout(this.showTime);clearTimeout(this.hideTime);this.element.unbind(".tooltip");this.tip.remove()}});a.om.lang.omTooltip={FailedToLoad:"加载提示信息出错！"}})(jQuery);