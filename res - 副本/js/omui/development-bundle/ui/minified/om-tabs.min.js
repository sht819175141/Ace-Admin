(function(){var f="om-tabs-"+(((1+Math.random())*65536)|0).toString(16).substring(1)+"-",e=0;var b="om-tabs-activated om-state-active",c="om-tabs-scroll-disabled";function a(h,g){if(g.content){$(h).html(g.content)}return $(h).omPanel(g)}function d(){return $.browser.msie&&parseInt($.browser.version)==7}$.omWidget("om.omTabs",{options:{width:"auto",height:"auto",border:true,tabWidth:"auto",tabHeight:27,scrollable:true,closable:false,position:"top",switchMode:"click",autoPlay:false,interval:1000,active:0,lazyLoad:false,tabMenu:false,onBeforeActivate:function(h,g){},onActivate:function(h,g){},onBeforeClose:function(h,g){},onClose:function(h,g){},onBeforeCloseAll:function(g){},onCloseAll:function(){},onAdd:function(g,h){},onBeforeAdd:function(g,h){},onLoadComplete:function(g,h){}},add:function(g){this._add(g)},close:function(g){this._close(g)},closeAll:function(){this._closeAll()},activate:function(g){this._activate(g)},getAlter:function(g){return this._getAlter(g)},getActivated:function(){return this._getActivated()},getLength:function(){return this._getLength()},setDataSource:function(g){if(g.index===undefined||(!g.url&&!g.content)){return}this._setDataSource(g)},reload:function(h,g,i){this._reload(h,g,i)},doLayout:function(){this._doLayout()},_create:function(){this._makeSketch();this._collectItems();this.history=[]},_init:function(){this._render();this._afterRender();this._buildEvent()},_makeSketch:function(){this.element.addClass("om-tabs om-widget om-widget-content om-corner-all").append('<div class="om-tabs-panels om-widget-content om-corner-bottom" />').find(">ul").wrap('<div class="om-tabs-headers om-helper-reset om-helper-clearfix om-widget-header om-corner-all" />');this.$menu=$("<div></div>").appendTo($("body"))},_collectItems:function(){var g=this,k=this.element,j=this.options,i=[],h=[];k.find(">div.om-tabs-headers a").each(function(){var m=this.getAttribute("href",2);var q=m.split("#")[0],s;if(q&&(q===location.toString().split("#")[0]||(s=$("base")[0])&&q===s.href)){m=this.hash;this.href=m}var o=$(this);var n=o.attr("tabId")||o.attr("id")||f+e++;o.attr("tabId",n);var l={tabId:n,title:o.text(),_closeMode:"visibility",header:false,closed:true,onSuccess:function(t,v,u){g._trigger("onLoadComplete",null,l.tabId)},onError:function(u,v,t){g._trigger("onLoadComplete",null,l.tabId)}};var r=$(">"+m,k)[0];if(!r&&m.indexOf("#")!=0){if(j.lazyLoad===false){l.url=m}else{h.push({tabId:n,url:m,loaded:false})}}var p=new a(r||$("<div></div>")[0],l);i.push(p)});$lis=k.find(">div.om-tabs-headers ul li");$('<span class="left-placeholder"></span>').insertBefore($lis.eq(0));$('<span class="right-placeholder"></span>').insertAfter($lis.eq($lis.length-1));if(h.length>0){this.loadInfo=h}this.items=i},_render:function(){var h=this,l=this.element,j=this.options,g=this.items,k=l.find(">div.om-tabs-headers");if(typeof j.active=="number"){if(j.active<0){j.active=0}if(j.active>g.length-1){j.active=g.length-1}}if(j.border!==false){l.children(":first").addClass("header-no-border")}if(j.width=="fit"){l.outerWidth(l.parent().width())}else{if(j.width!="auto"){l.css("width",j.width);var m=isNaN(j.width)&&j.width.indexOf("%")!=-1;l.children(":first").outerWidth(m?"100%":j.width)}}if(j.height=="fit"){l.outerHeight(l.parent().height())}else{if(j.height!="auto"){l.css("height",j.height)}}if(j.closable&&j.tabMenu&&$.fn.omMenu){var i=l.attr("id");this.menu=this.$menu.omMenu({contextMenu:true,dataSource:[{id:i+"_001",label:"关闭"},{id:i+"_002",label:"关闭其它"},{id:i+"_003",label:"关闭所有"}],onSelect:function(n,o){if(n.id==i+"_001"){h.close(h.getAlter($(h.$currentLi).find("a.om-tabs-inner").attr("tabid")))}else{if(n.id==i+"_002"){k.find("ul li").each(function(q,r){var p=$(h.$currentLi).find("a.om-tabs-inner").attr("tabid");var s=$(r).find("a.om-tabs-inner").attr("tabid");if(p===s){return}h.close(h.getAlter(s))})}else{if(n.id==i+"_003"){h.closeAll()}}}}})}this._renderHeader();this._renderBody()},_renderHeader:function(){var j=this.element,g=this.options,h=this.history;$headers=j.find(">div.om-tabs-headers"),$lis=$headers.find("ul li");$lis.addClass("om-state-default om-corner-top");$lis.each(function(l){var k=$(this).find("a:first");if(d()){k.attr("hideFocus","true")}k.addClass("om-tabs-inner");if(l===g.active||g.active===k.attr("tabId")){$(this).addClass(b);g.activeTabId=k.attr("tabId");g.active=l;if(!$.inArray(g.activeTabId,h)){h.push(g.activeTabId)}}else{$(this).removeClass(b)}k.css({width:g.tabWidth,height:g.tabHeight});$('<span class="lileft"></span>').insertBefore(k);if(g.closable===true||($.isArray(g.closable)&&-1!==$.inArray(l,g.closable))){if(k.next(".om-icon-close").length<=0){$('<a class="om-icon om-icon-close"></a>').insertAfter(k)}$('<span class="liright"></span>').insertAfter(k.next(".om-icon-close"))}else{k.next().remove();$('<span class="liright"></span>').insertAfter(k)}});var i=$lis.find("a.om-tabs-inner").height();$lis.parent().css({height:++i,"line-height":i+"px"});$headers.height(i);this._checkScroller()&&this._enableScroller()},_renderBody:function(){var n=this.element,j=this.options,h=this.items,m=n.find(">div.om-tabs-panels");m.children().detach();if(j.height!=="auto"){var g=n.innerHeight(),l=n.find(">div.om-tabs-headers").outerHeight();m.css("height",g-l)}n.toggleClass("om-tabs-noborder",!j.border);var k=h.length;while(k--){h[k].addClass("om-state-nobd").parent().prependTo(m)}},_afterRender:function(){var n=this.element,k=this.options,h=this.items;var l=h.length;n.children().each(function(){$(this).is(".om-tabs-headers,.om-tabs-panels")||$(this).remove()});if(!k.lazyLoad){$(h).omPanel("reload")}else{var g=$(h[k.active]);var m=g.omPanel("option","tabId");var j=this._getUnloadedUrl(m);g.omPanel("open");g.omPanel("reload",j);this._removeLoadInfo(m)}while(l--){var g=$(h[l]);if(l==k.active){g.omPanel("open")}else{g.omPanel("close")}}n.css("height",n.height());n.css("height",k.height)},_buildEvent:function(){var j=this,n=this.element,g=this.options,h=n.find(">div.om-tabs-headers a.om-icon-close");h.unbind("click.omtabs").bind("click.omtabs",function(p){var o=$(p.target).prev().attr("tabId");j._close(o);return false});var l=n.find(">div.om-tabs-headers a.om-tabs-inner");if(g.switchMode.indexOf("mouseover")!=-1){l.bind("mouseover.omtabs",function(){var o=$(this).attr("tabId"),p=$.data(n,"activateTimer");(typeof p!=="undefined")&&clearTimeout(p);p=setTimeout(function(){j._activate(o);return false},100);$.data(n,"activateTimer",p)})}else{if(g.switchMode.indexOf("click")!=-1){l.bind("click.omtabs",function(){j._activate($(this).attr("tabId"))})}}l.bind("click.omtabs",function(){return false});if(g.autoPlay!=false){g.autoInterId=setInterval(function(){n.omTabs("activate","next")},g.interval)}else{clearInterval(g.autoInterId)}if(g.switchMode.indexOf("mouseover")==-1){var i=n.find(">div.om-tabs-headers li");var k=function(p,o){if(o.is(":not(.om-state-disabled)")){o.addClass("om-state-"+p)}};var m=function(p,o){o.removeClass("om-state-"+p)};i.bind("mouseover.omtabs",function(){k("hover",$(this))});i.bind("mouseout.omtabs",function(){m("hover",$(this))});if(g.closable&&g.tabMenu){i.each(function(o,p){$(p).bind("contextmenu",function(q){if($.fn.omMenu){j.$currentLi=this;$(j.menu).omMenu("show",q)}})})}}n.find(">div.om-tabs-headers >span").bind("click.omtabs",function(o){if($(this).hasClass("om-tabs-scroll-disabled")){return false}var p=$(this).parent().find("ul").children("li:last").outerWidth(true);if($(this).hasClass("om-tabs-scroll-left")){j._scroll(p,j._scrollCbFn())}if($(this).hasClass("om-tabs-scroll-right")){j._scroll(-p,j._scrollCbFn())}return false})},_purgeEvent:function(){var i=this.element,g=this.options;var h=i.find(">div.om-tabs-headers");h.children().unbind(".omtabs");h.find(">ul >li >a").unbind(".omtabs");if(g.autoInterId){clearInterval(g.autoInterId)}},_activate:function(s){var x=this.element,j=this.options,r=this.items,k;var o=x.find(">div.om-tabs-headers ul");if(j.activeTabId===s||j.active===s){return false}s=s||0;var p,w=s;if(s=="next"){s=(j.active+1)%r.length}else{if(s=="prev"){s=(j.active-1)%r.length}}if(typeof s=="number"){w=this._getAlter(s)}else{if(typeof s=="string"){s=this._getAlter(s)}}if(j.onBeforeActivate&&this._trigger("onBeforeActivate",null,s)===false){return false}p=o.find("li a[tabId="+w+"]");p.parent().addClass(b).siblings().removeClass(b);j.activeTabId=w;j.active=s;var u=r.length;for(u=r.length;u--;u>=0){var h=r[u];if(h.omPanel("option","tabId")==w){h.omPanel("open");if(k=this._getUnloadedUrl(w)){h.omPanel("reload",k);this._removeLoadInfo(w)}}}for(u=r.length;u--;u>=0){var h=r[u];if(h.omPanel("option","tabId")!=w){h.omPanel("close")}}if(this._checkScroller()){o.stop(true,true);x.clearQueue();var q=o.prev();var z=o.next();var t=p.parent().offset().left;var v=t+p.parent().outerWidth(true);var m=q.offset().left+q.outerWidth(true)+4-t;var g=z.offset().left-v;if(m>=0){this._scroll(m,this._scrollCbFn())}else{if(g<=0){this._scroll(g,this._scrollCbFn())}else{this._scrollCbFn()()}}}var y=this.history,l=$.inArray(w,y);l===-1?y.push(w):y.push(y.splice(l,1)[0]);j.onActivate&&this._trigger("onActivate",null,s)},_getUnloadedUrl:function(h){var j=this.loadInfo;for(var g in j){if(j[g].tabId===h&&j[g].loaded===false){return j[g].url}}return null},_removeLoadInfo:function(j){var h=this.loadInfo,g,i;if(h){g=h.length;while(i=h[--g]){if(i.tabId===j){h.splice(g,1);break}}}},_addLoadInfo:function(h,g){this.loadInfo.push({tabId:h,loaded:false,url:g})},_getAlter:function(i){var h=this.element,g;if(typeof i=="number"){g=h.find(">div.om-tabs-headers li:eq("+i+") a.om-tabs-inner").attr("tabId")}else{if(typeof i=="string"){h.find(">div.om-tabs-headers li a.om-tabs-inner").each(function(j){if($(this).attr("tabId")==i){g=j;return false}})}}return g===undefined?null:g},_getActivated:function(){return this.options.activeTabId},_add:function(i){var m=this,o=this.element,q=this.options,l=this.items;var j=o.find(">div.om-tabs-headers ul");var h=i.tabId?i.tabId:f+e++;i.index=i.index||"last";if(i.index=="last"||i.index>l.length-1){i.index=l.length}i.title=i.title||"New Title "+h;i.url=$.trim(i.url);i.content=$.trim(i.content);if(i.url){i.content=undefined}else{i.url=undefined;i.content=i.content||"New Content "+h}if(q.onBeforeAdd&&m._trigger("onBeforeAdd",null,i)==false){return false}var n=$('<li class="om-state-default om-corner-top"> </li>');var p=$('<a class="om-tabs-inner"></a>').html(i.title).attr({href:"#"+h,tabId:h}).css({width:q.tabWidth,height:q.tabHeight}).appendTo(n);$('<span class="lileft"></span>').insertBefore(p);if(d()){p.attr("hideFocus","true")}if((i.closable===true)||(i.closable==undefined&&q.closable)){p.after('<a class="om-icon om-icon-close"></a>');$('<span class="liright"></span>').insertAfter(p.next(".om-icon-close"))}else{$('<span class="liright"></span>').insertAfter(p)}var k={tabId:h,title:p.text(),_closeMode:"visibility",header:false,closed:true,onSuccess:function(r,t,s){m._trigger("onLoadComplete",null,h)},onError:function(s,t,r){m._trigger("onLoadComplete",null,h)}};$.extend(k,i);if(i.url&&(q.lazyLoad||i.lazyLoad)){m.loadInfo.push({tabId:h,url:i.url,loaded:false});k.url=null}var g=new a($("<div>"+(i.content||"")+"</div>")[0],k);if(i.index==l.length){l[i.index]=g;n.insertBefore(j.find("span.right-placeholder"))}else{l.splice(i.index,0,g);j.children().eq(i.index).before(n)}if(j.innerWidth()-n.position().left<500){j.width(j.width()+500)}this._checkScroller()&&this._enableScroller();l[i.index].addClass("om-state-nobd").parent().insertAfter(i.index>0?o.find(">div.om-tabs-panels").children().eq(i.index-1):0);this._purgeEvent();this._buildEvent();this._trigger("onAdd",null,k);if(!(i.activateNew===false)){this._activate(i.index)}},_close:function(m){var p=this.element,q=this.options,n=this.items,o=p.find(">div.om-tabs-headers"),h=p.find(">div.om-tabs-panels"),k=p.height(),j=m,g=this.history;m=(m===undefined?q.active:m);if(typeof m=="string"){m=this._getAlter(m)}else{j=this._getAlter(m)}if(q.onBeforeClose&&this._trigger("onBeforeClose",null,m)==false){return false}this._removeLoadInfo(this._getAlter(m));o.find("li").eq(m).remove();h.children().find(">.om-panel-body").eq(m).empty().remove();n.splice(m,1);if(h.children().length==0){h.css({height:k-o.outerHeight()})}for(var l=g.length-1;l>=0;l--){if(j===g[l]){g.splice(l,1);break}}q.onClose&&this._trigger("onClose",null,m);if(n.length==0){q.active=-1;q.activeTabId=null;return}else{if(m==q.active){q.active=-1;this._activate(g.length>0?g.pop():0)}else{m<q.active&&q.active--;this._checkScroller()&&this._enableScroller()}}},_closeAll:function(){var o=this.element,k=this.options,j=this.items,n=o.find(">div.om-tabs-headers"),m=o.find(">div.om-tabs-panels"),h=o.height();if(k.onBeforeCloseAll&&this._trigger("onBeforeCloseAll")===false){return false}for(var l=0,g=j.length;l<g;l++){this._removeLoadInfo(j[l].omPanel("option","tabId"))}n.find("li").remove();m.empty();j.splice(0,j.length);m.css({height:h-n.outerHeight()});k.active=-1;k.activeTabId=null;this.history=[];k.onCloseAll&&this._trigger("onCloseAll")},_checkScroller:function(){var l=this.element,k=this.options;if(!k.scrollable){return false}var j=l.find(">div.om-tabs-headers ul");var h=4;j.children().each(function(){h+=$(this).outerWidth(true)});if(h>j.parent().innerWidth()){if(!j.hasClass("om-tabs-scrollable")){var m=$("<span></span>").insertBefore(j).addClass("om-tabs-scroll-left");var i=$("<span></span>").insertAfter(j).addClass("om-tabs-scroll-right");var g=(j.height()-m.height())/2;j.addClass("om-tabs-scrollable")}return true}else{j.removeClass("om-tabs-scrollable").siblings().remove();return false}},_scrollCbFn:function(){var g=this;return function(){g._enableScroller()}},_enableScroller:function(){var n=this.element.find(">div.om-tabs-headers"),l=n.children("ul"),o=l.prev(),j=l.next(),m=l.children(":last"),g=n.offset().left,k=j.offset().left,h=l.offset().left,i=m.offset().left+m.outerWidth(true);o.toggleClass(c+" om-tabs-scroll-disabled-left",h>=g);j.toggleClass(c+" om-tabs-scroll-disabled-right",i<=k)},_scroll:function(k,i){var g=this;$self=this.element,$ul=$self.find(">div.om-tabs-headers ul"),$li=$ul.children(":last");if(k==0){return}var h=k>0?$ul.prev().offset():$ul.next().offset();var j=function(m){if(k>0&&$ul.prev().hasClass(c)||k<0&&$ul.next().hasClass(c)){$ul.stop(true,true);$self.clearQueue();return}var l=false;k=(k>0)?"+="+Math.min(h.left-$ul.offset().left,k):"-="+Math.min($li.offset().left+$li.outerWidth(true)-h.left,Math.abs(k));g.isScrolling=true;$ul.animate({left:k+"px"},"normal","swing",function(){!!i&&i();g.isScrolling=false;m()})};$self.queue(j);if($self.queue().length==1&&!g.isScrolling){$self.dequeue()}},_getLength:function(){return this.items.length},_doLayout:function(){this._checkScroller()&&this._enableScroller()},_setDataSource:function(j){var k=this.element,g=this.items,i=this.options,h=this._getAlter(j.index);j.url=$.trim(j.url);j.content=$.trim(j.content);if(j.url){if(i.lazyLoad!==false){this._addLoadInfo(h,j.url);g[j.index].omPanel("option","url",j.url)}else{this._removeLoadInfo(h);g[j.index].omPanel("reload",j.url)}}else{g[j.index].html(j.content)}},_reload:function(j,i,k){var l=this.element,g=this.items,h=this._getAlter(j);if(i){this._removeLoadInfo(h);g[j].omPanel("reload",i)}else{if(k){g[j].html(k)}else{g[j].omPanel("reload",this._getUnloadedUrl(h));this._removeLoadInfo(h)}}}})})(jQuery);